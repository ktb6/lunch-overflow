name: Branch and Commit Message Check

on:
  push:
    branches:
      - "*"
  pull_request:
    branches:
      - "*"

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - name: Check out the code
        uses: actions/checkout@v2

      - name: Validate branch name
        run: |
          BRANCH_NAME="${{ github.event.pull_request.head.ref }}"
          if ! [[ "$BRANCH_NAME" =~ ^(feature|bugfix|hotfix|release|develop)/[A-Z]+-[0-9]+.*$ ]]; then
            echo "Error: Branch name must start with feature/, bugfix/, hotfix/, or release/ followed by Jira ticket (e.g., feature/PROJ-1234)."
            exit 1
          fi

      - name: Validate commit message
        run: |
          COMMIT_MSG=$(git log -1 --pretty=%B)
          if ! [[ "$COMMIT_MSG" =~ ^[A-Z]+-[0-9]+ ]]; then
            echo "Error: Commit message must start with a Jira ticket (e.g., PROJ-1234)."
            exit 1
          fi
